import java.io.IOException;
import java.util.Arrays;

import static java.lang.System.out;

public class Qspec {

    public static int runMvnBuildQspec(String QLIBPATH, String QINIT, String QSPEC_TESTS_DIR) throws IOException, InterruptedException {
        String[] cmdLineParams = new String[]{
                "target/qspecLib/spec.q",
                "-q",
                QSPEC_TESTS_DIR};

        out.println("Starting qspec process:" + Arrays.toString(cmdLineParams));

        Process p = KdbProcess.startKdbProcess(cmdLineParams, "target/qhome", QINIT, "", QLIBPATH);
        p.waitFor();

        int exitValue = p.exitValue();
        out.println("qspecProcess exitValue=" + exitValue);
        return exitValue;
    }

    public static int runQspec() throws IOException, InterruptedException {
        String QLIBPATH = "target/KdbCoreLib/core"
                + "::target/KdbCoreLib/core1"
                + "::target/qspecLib/init.q";

        String QINIT = "target/KdbCoreLib/loadQLIBPATH.q";

        String QSPEC_TESTS_DIR = "src/test/qspec";

        return runMvnBuildQspec(QLIBPATH, QINIT, QSPEC_TESTS_DIR);
    }

    public static int runQspecFailHard() throws InterruptedException, IOException {
        String QLIBPATH = "target/KdbCoreLib/core"
                +"::target/KdbCoreLib/core1"
                +"::target/qspecLib/init.q";
        String QINIT= "target/KdbCoreLib/loadQLIBPATH.q";
        String QSPEC_TESTS_DIR = "src/test/qspec";

        String[] qspecCmd = new String[]{
                "target/qspecLib/spec.q",
                "-q",
                QSPEC_TESTS_DIR,
                "--fail-hard"};

        Process p = KdbProcess.startKdbProcess(qspecCmd, "target/qhome", QINIT, "", QLIBPATH);
        p.waitFor();

        int exitValue = p.exitValue();
        out.println("qspecProcess exitValue=" + exitValue);
        return exitValue;
    }
}
