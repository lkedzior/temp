.Q.hdpf{[h;d;p;f]
  (@[`.;;0#]dpft[d;p;f]@)'t@>(#.:)'t:.q.tables`.;
  if[h:@[<:;h;0];h"\\l .";>h]
}

.Q.dpft{[d;p;f;t]
  if[~&/qm'r:+en[d]`. . `\:t;'`unmappable];
  {[d;t;i;x]@[d;x;:;t[x]i]}[d:par[d;p;t];r;<r f]'!r;
  @[;f;`p#]@[d;`.d;:;f,r@&~f=r:!r];
  t
}

.Q.par{[d;p;t]
  `/:($[@!h:`/:d,`par.txt;`$":",h .q.mod[p;#h:0:h];d];`$$p;t)
 }